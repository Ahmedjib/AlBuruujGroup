<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_sh_stock_picking_inherit_delete" model="ir.actions.server">
        <field name="name">Delete</field>
        <field name="groups_id" eval="[(4, ref('sh_all_in_one_cancel_adv.group_sh_stock_cancel'))]"/>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <!--        <field name="binding_view_types">list</field>-->
        <field name="state">code</field>
        <field name="code">
            if records:
            action = records.sh_cancel()
        </field>
    </record>

    <record id="view_view_picking_internal_search_expense" model="ir.ui.view">
        <field name="name">view.view.picking.internal.search.expense</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='origin']" position="after">
                <field name="next_approval_id"/>
            </xpath>
<!--            <xpath expr="//filter[@name='draft']" position="before">-->
<!--                <filter name="draft" string="Draft" domain="[('state', '=', 'draft')]" help="Draft Moves"/>-->
<!--            </xpath>-->
            <xpath expr="//filter[@name='status']" position="before">
                <filter string="Expense Transfer Status" name="expense_status"
                        domain="[]" context="{'group_by': 'next_approval_id'}"/>
            </xpath>
        </field>
    </record>

    <record id="view_vpicktree_inherit_expense" model="ir.ui.view">
        <field name="name">view.vpicktree.inherit.expense</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="attributes">
                <attribute name="delete">0</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_picking_form_inherit_expense" model="ir.ui.view">
        <field name="name">view.picking.form.inherit.expense</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="attributes">
                <attribute name="delete">0</attribute>
            </xpath>
<!--            <xpath expr="//button[@name='action_cancel']" position="after">-->
<!--                <button name="sh_cancel" string="Delete"-->
<!--                        type="object" groups="sh_all_in_one_cancel_adv.group_sh_stock_cancel"-->
<!--                        attrs="{'invisible':[('is_expense', '!=', True)]}"/>-->
<!--            </xpath>-->
            <xpath expr="//field[@name='is_locked']" position="after">
                <field name="is_expense" invisible="1"/>
                <field name="expense_picking_type_id" invisible="1"/>
                <field name="is_button" invisible="1"/>
                <field name="is_last_lavel" invisible="1"/>

            </xpath>
            <button name="action_cancel" position="after">
                <button name="sh_cancel" string="Delete"
                        type="object" groups="sh_all_in_one_cancel_adv.group_sh_stock_cancel"
                        attrs="{'invisible':[('is_expense', '!=', True)]}"/>
            </button>

            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="employee_id" attrs="{'invisible':[('is_expense', '!=', True)], 'required': [('is_expense', '=', True)]}"/>
                <field name="state" string="Inventory Manager Status" attrs="{'invisible': [('is_expense', '=', False)]}"/>
            </xpath>

            <xpath expr="//header" position="inside">
                <button name="action_approve" type="object"
                        attrs="{'invisible': ['|',('is_button', '=', False),('is_expense', '!=', True)]}"
                        string="Approve / Reject" class="oe_highlight" />
            </xpath>
<!--            <xpath expr="//button[@name='action_open_label_layout']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible': [('is_expense', '=', True)]}</attribute>-->
<!--            </xpath>-->
            <xpath expr="//button[@name='button_scrap']" position="replace">
                <button name="button_scrap" type="object" string="Scrap"
                        attrs="{'invisible': ['|', '&amp;', ('picking_type_code', '=', 'incoming'), ('state', '!=', 'done'), '|', '&amp;', ('picking_type_code', '=', 'outgoing'),('state', '=', 'done'), ('is_expense', '=', True)]}"
                        data-hotkey="y"/>
            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="replace">
                <button name="action_cancel" attrs="{'invisible': ['|', ('is_expense', '=', True), ('state', 'not in', ('assigned', 'confirmed', 'draft', 'waiting'))]}" string="Cancel" groups="base.group_user" type="object" data-hotkey="z"/>
            </xpath>

            <xpath expr="//field[@name='state']" position="before">
                <field name="next_approval_id" widget="statusbar"  attrs="{'invisible': [('is_expense', '!=', True)]}"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_expense', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='origin']" position="after">
                <field name="property_stock_account_output_categ_id"
                       attrs="{'required':[('is_expense', '=', True), ('state', 'not in', ('done', 'cancel'))],
                                   'readonly':[('state', 'in', ('done', 'cancel'))],
                                   'invisible': [('is_expense', '=', False)]}"/>
            </xpath>
        </field>
    </record>

    <record id="action_picking_expense" model="ir.actions.act_window">
        <field name="name">Expense Transfers</field>
        <field name="res_model">stock.picking</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree,kanban,form,calendar</field>
        <field name="domain">[('is_expense', '=', True)]</field>
        <field name="context">{'contact_display': 'partner_address',
            'default_is_expense': True,

            'default_company_id': allowed_company_ids[0]}</field>
        <field name="search_view_id" ref="stock.view_picking_internal_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No transfer found. Let's create one!
            </p><p>
            Transfers allow you to move products from one location to another.
        </p>
        </field>
    </record>
    <record id="stock.action_picking_tree_all" model="ir.actions.act_window">
        <field name="name">Transfers</field>
        <field name="res_model">stock.picking</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree,kanban,form,calendar</field>
        <field name="domain">[('is_expense', '!=', True)]</field>
        <field name="context">{'contact_display': 'partner_address', 'default_company_id': allowed_company_ids[0]}</field>
        <field name="search_view_id" ref="stock.view_picking_internal_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No transfer found. Let's create one!
            </p><p>
            Transfers allow you to move products from one location to another.
        </p>
        </field>
    </record>

    <menuitem id="expense_picking" name="Expense Transfers"
              parent="stock.menu_stock_warehouse_mgmt" sequence="5"
              action="action_picking_expense"
              groups="stock.group_stock_manager,stock.group_stock_user"/>

    <record model="ir.ui.view" id="approval_level_tree_view">
        <field name="name">approval.level.tree</field>
        <field name="model">approval.level</field>
        <field name="arch" type="xml">
            <tree string="Approval Level Form">
                <field name="name" />
                <field name="level" />
                <field name="is_last_approval" />
                <field name="is_reject" />
                <field name="approval_user_id" />
            </tree>
        </field>
    </record>
    <record model="ir.ui.view" id="approval_level_form_view">
        <field name="name">approval.level.form</field>
        <field name="model">approval.level</field>
        <field name="arch" type="xml">
            <form string="Approval Level Form">
                <sheet>
                    <group>
                        <field name="name" required="1" />
                        <field name="level" required="1" />
                        <field name="is_last_approval" />
                        <field name="is_reject" />
                        <field name="approval_user_id" attrs="{'required': [('is_reject', '=', False)]}" />
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <record id="action_approval_level" model="ir.actions.act_window">
        <field name="name">Approval Level</field>
        <field name="res_model">approval.level</field>
        <field name="type">ir.actions.act_window</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_approval_level" parent="stock.menu_stock_config_settings"
              name="Approval Level" action="action_approval_level"
              groups="base.group_system" sequence="4" />
</odoo>